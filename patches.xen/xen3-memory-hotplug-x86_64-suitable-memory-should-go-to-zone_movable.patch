From: Wang Nan <wangnan0@huawei.com>
Subject: memory-hotplug: x86_64: suitable memory should go to ZONE_MOVABLE

References: fate#316483
Patch-mainline: Never, SUSE-Xen specific

This patch introduces zone_for_memory() to arch_add_memory() on x86_64 to
ensure new, higher memory added into ZONE_MOVABLE if movable zone has
already setup.

Signed-off-by: Wang Nan <wangnan0@huawei.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Mel Gorman <mgorman@suse.de>
Automatically created from "patches.suse/memory-hotplug-x86_64-suitable-memory-should-go-to-zone_movable.patch" by xen-port-patches.py

--- sle12.orig/arch/x86/mm/init_64-xen.c	2014-02-06 15:14:14.000000000 +0100
+++ sle12/arch/x86/mm/init_64-xen.c	2014-08-08 11:41:51.000000000 +0200
@@ -1004,7 +1004,8 @@ static void  update_end_of_memory_vars(u
 int arch_add_memory(int nid, u64 start, u64 size)
 {
 	struct pglist_data *pgdat = NODE_DATA(nid);
-	struct zone *zone = pgdat->node_zones + ZONE_NORMAL;
+	struct zone *zone = pgdat->node_zones +
+		zone_for_memory(nid, start, size, ZONE_NORMAL);
 	unsigned long start_pfn = start >> PAGE_SHIFT;
 	unsigned long nr_pages = size >> PAGE_SHIFT;
 	int ret;
